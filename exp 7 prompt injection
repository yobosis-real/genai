!pip install -q google-generativeai ipywidgets
from google.colab import output; output.enable_custom_widget_manager()

import google.generativeai as genai
import ipywidgets as widgets
from IPython.display import display, Markdown
import re

# Configure Gemini API
genai.configure(api_key="AIzaSyCgFcYAigEUSiA29Lwl4A254oLMkg-7_ro")
model = genai.GenerativeModel("gemini-2.5-flash-lite")

# Very simple prompt-injection check
def is_prompt_injection(text):
    patterns = [
        r"ignore previous instructions",
        r"forget all rules",
        r"jailbreak",
        r"pretend you are",
        r"act as",
        r"system:"
    ]
    return any(re.search(p, text, re.IGNORECASE) for p in patterns)

# Secure chat function
def secure_chat(text):
    if is_prompt_injection(text):
        return  "Blocked (possible prompt injection detected)"

    response = model.generate_content(text)
    return response.text

# Widgets
user_input = widgets.Textarea(
    placeholder="Type here...",
    layout=widgets.Layout(width="100%", height="150px")
)

button = widgets.Button(description="Send")
out = widgets.Output()

def on_click(b):
    with out:
        out.clear_output()
        result = secure_chat(user_input.value)
        display(Markdown("### Result:\n" + result))
        user_input.value = ""

button.on_click(on_click)

display(user_input, button, out)
